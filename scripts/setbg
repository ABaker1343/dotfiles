#!/bin/sh

printUsage() {
    echo "    -f : file path of image
    -t : pywal theme to use
    -s : saturation value"
}

saturation=""
file=""
while getopts "f:s:t" opt; do
    case $opt in
    s) saturation=$OPTARG;;
    f) file=$OPTARG;;
    t) theme=$OPTARG;;
    ?) echo "invalid switch"; printUsage; exit;;
    esac
done
if [ ! -n "$file" ]; then
    exit
fi

cp $file ~/bg/bg1.png
echo "new background: $file"

if test -z "$saturation"; then
    echo "no saturation given"
    saturation=0.6
fi
if test -z "$theme"; then
	wal -n -i $file --saturate $saturation
else
	wal -n --theme $theme
fi

echo "background_opacity 0.75" >> ~/.cache/wal/colors-kitty.conf
pywal-extender
cd ~/.source/st/
sudo make clean install
cd ~/.source/dmenu/
sudo make clean install
~/.spicetify/spicetify apply

